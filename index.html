<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Fuho API ExamplePage</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Flatpickr CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    
    <style>
        /* Custom styles */
        body {
            font-family: Menlo, Monaco, Consolas, 'Courier New', monospace;
            background-color: #212529;
            color: #ffffff;
            padding: 50px;
        }
        form {
            max-width: 400px;
            margin: auto;
        }
        .dropdown-container {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }
        .dropdown {
            margin-right: 10px;
        }
        .terminal {
            text-align: left;
            margin: auto;
            max-width: 800px;
            background-color: #212529;
            border: 1px solid #ffffff;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 20px;
            max-height: 500px;
            overflow-y: auto;
        }
        .terminal h3 {
            text-align: center;
        }
        .terminal pre {
            white-space: pre-wrap;
            word-break: break-all;
            color: #ffffff;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <h1 class="text-center mb-5">Fuho API ExamplePage</h1>

    <div class="dropdown-container">
        <div class="dropdown text-center mb-3">
            <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-expanded="false">
                GMS API
            </button>
            <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                <li><a class="dropdown-item" href="#" data-api="GMS_API1">Device Status</a></li>
                <li><a class="dropdown-item" href="#" data-api="GMS_API2">Server Playback</a></li>
                <li><a class="dropdown-item" href="#" data-api="GMS_API3">Remote Playback</a></li>
            </ul>
        </div>
        <div class="dropdown text-center mb-3">
            <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton1" data-bs-toggle="dropdown" aria-expanded="false">
                GMS+ API
            </button>
            <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
                <li><a class="dropdown-item" href="#" data-api="GMS2_API1">API 1</a></li>
                <li><a class="dropdown-item" href="#" data-api="GMS2_API2">API 2</a></li>
                <li><a class="dropdown-item" href="#" data-api="GMS2_API3">API 3</a></li>
            </ul>
        </div>
    </div>

    <form id="apiForm">
        <div class="mb-3" id="GMS_API1_Fields" style="display:none;">
            <label for="GMS_API1_ip" class="form-label">IP Address:</label>
            <input type="text" class="form-control" id="GMS_API1_ip" name="ip" required><br>

            <label for="GMS_API1_username" class="form-label">Username:</label>
            <input type="text" class="form-control" id="GMS_API1_username" name="username" required><br>

            <label for="GMS_API1_password" class="form-label">Password:</label>
            <input type="text" class="form-control" id="GMS_API1_password" name="password" required><br>

            <label for="GMS_API1_deviceid" class="form-label">Device ID:</label>
            <input type="text" class="form-control" id="GMS_API1_deviceid" name="deviceid" required><br>

            <div class="text-center">
                <button type="button" class="btn btn-primary" id="GMS_API1_button">Submit</button>
            </div>            
        </div>
        <div class="mb-3" id="GMS_API2_Fields" style="display:none;">
            <label for="GMS_API2_ip" class="form-label">IP Address:</label>
            <input type="text" class="form-control" id="GMS_API2_ip" name="ip" required><br>

            <label for="GMS_API2_username" class="form-label">Username:</label>
            <input type="text" class="form-control" id="GMS_API2_username" name="username" required><br>

            <label for="GMS_API2_password" class="form-label">Password:</label>
            <input type="text" class="form-control" id="GMS_API2_password" name="password" required><br>

            <label for="GMS_API2_deviceid" class="form-label">Device ID:</label>
            <input type="text" class="form-control" id="GMS_API2_deviceid" name="deviceid" required><br>

            <label for="GMS_API2_ch" class="form-label">Channel:</label>
            <select class="form-select" id="GMS_API2_ch" name="ch" required>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
                <option value="7">7</option>
                <option value="8">8</option>
            </select><br>

            <label for="GMS_API2_spbtime" class="form-label">Start Time:</label>
            <input type="text" class="form-control" id="GMS_API2_spbtime" name="spbtime" required><br>

            <label for="GMS_API2_duration" class="form-label">Duration (1~3600):</label>
            <input type="text" class="form-control" id="GMS_API2_duration" name="duration" required><br>

            <label for="GMS_API2_lobk_format" class="form-label">File Format:</label>
            <select class="form-select" id="GMS_API2_lobk_format" name="lobk_format" required>
                <option value="mp4">mp4</option>
                <option value="gms">gms</option>
            </select><br>

            <div class="text-center">
                <button type="button" class="btn btn-primary" id="GMS_API2_button">Submit</button>
            </div>  
        </div>
        <div class="mb-3" id="GMS_API3_Fields" style="display:none;">
            <label for="GMS_API3_ip" class="form-label">IP Address:</label>
            <input type="text" class="form-control" id="GMS_API3_ip" name="ip" required><br>

            <label for="GMS_API3_username" class="form-label">Username:</label>
            <input type="text" class="form-control" id="GMS_API3_username" name="username" required><br>

            <label for="GMS_API3_password" class="form-label">Password:</label>
            <input type="text" class="form-control" id="GMS_API3_password" name="password" required><br>

            <label for="GMS_API3_deviceid" class="form-label">Device ID:</label>
            <input type="text" class="form-control" id="GMS_API3_deviceid" name="deviceid" required><br>

            <label for="GMS_API3_ch" class="form-label">Channel:</label>
            <select class="form-select" id="GMS_API3_ch" name="ch" required>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
                <option value="7">7</option>
                <option value="8">8</option>
            </select><br>

            <label for="GMS_API3_spbtime" class="form-label">Start Time:</label>
            <input type="text" class="form-control" id="GMS_API3_spbtime" name="spbtime" required><br>

            <label for="GMS_API3_duration" class="form-label">Duration (1~3600):</label>
            <input type="text" class="form-control" id="GMS_API3_duration" name="duration" required><br>

            <div class="text-center">
                <button type="button" class="btn btn-primary" id="GMS_API3_button">Submit</button>
            </div>  
        </div>
    </form>

    <div class="terminal mb-5" id="apiResult" style="display: none;">
        <h3>Generated Example:</h3>
        <pre id="generatedRequest"></pre>
    </div>

    <!-- Flatpickr JS -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Moment.js -->
    <script src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
   
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var submitButton1 = document.getElementById('GMS_API1_button');
            submitButton1.addEventListener('click', function() {
                var ip = document.getElementById('GMS_API1_ip').value;
                var username = document.getElementById('GMS_API1_username').value;
                var password = document.getElementById('GMS_API1_password').value;
                var deviceid = document.getElementById('GMS_API1_deviceid').value;
    
                // 將密碼轉換為 SHA256 的大寫形式
                var hashedPassword = sha256(password).toUpperCase();
                if (ip.endsWith('/')) {
                    ip = ip.slice(0, -1); // 切掉最後一個字符
                }
                var requestData = {
                    Post: ip + "/gkdevice/device",
                    headers: {
                        "Content-Type": "application/json; charset=utf-8"
                    },
                    data: {
                        "username": username,
                        "password": hashedPassword,
                        "deviceid": deviceid
                    },
                };
    
                var generatedRequest = document.getElementById('generatedRequest');
                generatedRequest.textContent = JSON.stringify(requestData, null, 2);
                document.getElementById('apiResult').style.display = 'block';
            });
    
            var submitButton2 = document.getElementById('GMS_API2_button');
            submitButton2.addEventListener('click', function() {
                var ip = document.getElementById('GMS_API2_ip').value;
                var username = document.getElementById('GMS_API2_username').value;
                var password = document.getElementById('GMS_API2_password').value;
                var deviceid = document.getElementById('GMS_API2_deviceid').value;
                var ch = document.getElementById('GMS_API2_ch').value;
                var spbtime = document.getElementById('GMS_API2_spbtime').value;
                var duration = document.getElementById('GMS_API2_duration').value;
                var lobk_format = document.getElementById('GMS_API2_lobk_format').value;
    
                // 將密碼轉換為 SHA256 的大寫形式
                var hashedPassword = sha256(password).toUpperCase();
                if (ip.endsWith('/')) {
                    ip = ip.slice(0, -1); // 切掉最後一個字符
                }
                spbtime = spbtime.replace(/\s/g, ''); // 移除空格
                spbtime = spbtime.replace(/-/g, ''); // 移除 -
                spbtime = spbtime.replace(':', ''); // 移除 :
                // 尝试解析时间
                var datetime = new Date(spbtime.slice(0, 4), // 年份
                                        spbtime.slice(4, 6) - 1, // 月份 (注意月份是从0开始计数的)
                                        spbtime.slice(6, 8), // 日
                                        spbtime.slice(8, 10), // 小时
                                        spbtime.slice(10, 12)); // 分钟
                // 解析日期和时间
                var year = parseInt(spbtime.substring(0, 4));
                var month = parseInt(spbtime.substring(4, 6));
                var day = parseInt(spbtime.substring(6, 8));
                var hour = parseInt(spbtime.substring(8, 10));
                var minute = parseInt(spbtime.substring(10, 12));
    
                // 转换日期和时间到UTC Unix时间戳
                var datetime = new Date(year, month - 1, day, hour, minute);
                var utcTimestamp = Math.floor(datetime.getTime() / 1000); // 使用Math.floor()取整
    
                console.log("UTC Unix timestamp (seconds):", utcTimestamp);
    
                console.log("Parsed spbtime:", spbtime);
                
                var requestData = {
                    ServerPlaybackAsk: ip + "/web.cgi?type=lobkask&user=" + username + "&password=" + hashedPassword + "&deviceid=" + deviceid + "&ch=" + ch + "&spbtime=" + utcTimestamp + "&duration=" + duration + "&format=" + lobk_format,
    
                    ServerPlaybackGet: ip + "/web.cgi?type=lobkget&user=" + username + "&password=" + hashedPassword + "&deviceid=" + deviceid + "&ch=" + ch + "&spbtime=" + utcTimestamp + "&duration=" + duration + "&format=" + lobk_format
                };
    
                var generatedRequest = document.getElementById('generatedRequest');
                generatedRequest.style.textAlign = 'left';
                generatedRequest.innerHTML = `
                    <pre style="padding-left: 20px; text-align: left;">
    {
    "ServerPlaybackAsk":
    "${requestData.ServerPlaybackAsk}"
    
    // This will response:
    // "already": false,  //true
    // "result": "CREATE OK" // "BACKUP FAIL" or "CREATE FAIL" or "HANDLING" or "DOWNLOAD OK"
    // when download is ok, then get file.
    
    "ServerPlaybackGet": 
    "${requestData.ServerPlaybackGet}"
    }
                    </pre>`;
                document.getElementById('apiResult').style.display = 'block';
            });
    
            var submitButton3 = document.getElementById('GMS_API3_button');
            submitButton3.addEventListener('click', function() {
                var ip = document.getElementById('GMS_API3_ip').value;
                var username = document.getElementById('GMS_API3_username').value;
                var password = document.getElementById('GMS_API3_password').value;
                var deviceid = document.getElementById('GMS_API3_deviceid').value;
                var ch = document.getElementById('GMS_API3_ch').value;
                var spbtime = document.getElementById('GMS_API3_spbtime').value;
                var duration = document.getElementById('GMS_API3_duration').value;
    
                // 將密碼轉換為 SHA256 的大寫形式
                var hashedPassword = sha256(password).toUpperCase();
                if (ip.endsWith('/')) {
                    ip = ip.slice(0, -1); // 切掉最後一個字符
                }
                spbtime = spbtime.replace(/\s/g, ''); // 移除空格
                spbtime = spbtime.replace(/-/g, ''); // 移除 -
                spbtime = spbtime.replace(':', ''); // 移除 :
                // 尝试解析时间
                var datetime = new Date(spbtime.slice(0, 4), // 年份
                                        spbtime.slice(4, 6) - 1, // 月份 (注意月份是从0开始计数的)
                                        spbtime.slice(6, 8), // 日
                                        spbtime.slice(8, 10), // 小时
                                        spbtime.slice(10, 12)); // 分钟
                // 解析日期和时间
                var year = parseInt(spbtime.substring(0, 4));
                var month = parseInt(spbtime.substring(4, 6));
                var day = parseInt(spbtime.substring(6, 8));
                var hour = parseInt(spbtime.substring(8, 10));
                var minute = parseInt(spbtime.substring(10, 12));
    
                // 转换日期和时间到UTC Unix时间戳
                var datetime = new Date(year, month - 1, day, hour, minute);
                var utcTimestamp = Math.floor(datetime.getTime() / 1000); // 使用Math.floor()取整
    
                console.log("UTC Unix timestamp (seconds):", utcTimestamp);
    
                console.log("Parsed spbtime:", spbtime);
                
                var requestData = {
                    RemotePlaybackAsk: ip + "/web.cgi?type=repbmp4ask&user=" + username + "&password=" + hashedPassword + "&deviceid=" + deviceid + "&ch=" + ch + "&spbtime=" + utcTimestamp + "&duration=" + duration,
    
                    RemotePlaybackGet: ip + "/web.cgi?type=repbmp4get&user=" + username + "&password=" + hashedPassword + "&deviceid=" + deviceid + "&ch=" + ch + "&spbtime=" + utcTimestamp + "&duration=" + duration
                };
    
                var generatedRequest = document.getElementById('generatedRequest');
                generatedRequest.style.textAlign = 'left';
                generatedRequest.innerHTML = `
                    <pre style="padding-left: 20px; text-align: left;">
    {
    "RemotePlaybackAsk":
    "${requestData.RemotePlaybackAsk}"
    
    // This will response:
    // "already": false,  //true
    // "result": "CREATE OK" // "BACKUP FAIL" or "CREATE FAIL" or "HANDLING" or "DOWNLOAD OK"
    // when download is ok, then get file.
    
    "RemotePlaybackGet": 
    "${requestData.RemotePlaybackGet}"
    }
                    </pre>`;
                document.getElementById('apiResult').style.display = 'block';
            });
    
            // 初始化 Flatpickr
            flatpickr("#GMS_API2_spbtime", {
                enableTime: true,
                dateFormat: "Y-m-d H:i",
            });
            flatpickr("#GMS_API3_spbtime", {
                enableTime: true,
                dateFormat: "Y-m-d H:i",
            });
    
            // 監聽下拉菜單的選擇事件，顯示相應的表單字段
            document.querySelectorAll('.dropdown-item').forEach(item => {
                item.addEventListener('click', function() {
                    var selectedAPI = this.getAttribute('data-api');
                    console.log("Selected API:", selectedAPI); // 打印選擇的 API
                    toggleForm(selectedAPI);
                });
            });
    
            // 函數：根據選擇的 API 顯示相應的表單字段
            function toggleForm(api) {
                var api1Fields = document.getElementById('GMS_API1_Fields');
                var api2Fields = document.getElementById('GMS_API2_Fields');
                var api3Fields = document.getElementById('GMS_API3_Fields');
                switch (api) {
                    case 'GMS_API1':
                        api1Fields.style.display = 'block';
                        api2Fields.style.display = 'none';
                        api3Fields.style.display = 'none';
                        break;
                    case 'GMS_API2':
                        api1Fields.style.display = 'none';
                        api2Fields.style.display = 'block';
                        api3Fields.style.display = 'none';
                        break;
                    case 'GMS_API3':
                        api1Fields.style.display = 'none';
                        api2Fields.style.display = 'none';
                        api3Fields.style.display = 'block';
                        break;
                    default:
                        api1Fields.style.display = 'none';
                        api2Fields.style.display = 'none';
                        api3Fields.style.display = 'none';
                        break;
                }
            }
        });
    </script>
    
    <!-- SHA256 function -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-sha256/0.9.0/sha256.min.js"></script>
</body>
</html>
